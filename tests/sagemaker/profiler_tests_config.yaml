- values:
  - [mnist_cpu.py: &mnist_cpu
      tests/sagemaker/scripts/mnist/mnist_cpu.py,
     mnist_gpu.py: &mnist_gpu
      tests/sagemaker/scripts/mnist/mnist_gpu.py,
     keras_resnet_hvd.py: &keras_resnet_hvd
      tests/sagemaker/scripts/resnet/keras_resnet_hvd.py,
     keras_resnet_mirrored.py: &keras_resnet_mirrored
      tests/sagemaker/scripts/resnet/keras_resnet_mirrored.py,
     Enable: &Enable # enable the test case
      True,
     Disable: &Disable # disable the test case
      False,
    ]

- cpu_jobs:
  -
    - smprofiler-IT-mnist-keras-cpu-default
    - *Enable
    - *mnist_cpu
    - AmazonSageMaker-ExecutionRole-20200205T150348
    - ml.c5.4xlarge
    - instance_count: 1
    - profiler_params:
        ProfilerEnabled: "True"
        DetailedProfilingConfig: "{\"StartStep\": \"1\" ,\"NumSteps\": \"5\"}"
        UsePyinstrument: "False"
    - expected_values_in_test_artifacts:
        python_trace_file_count: 1
        framework_trace_file_count: 13
        python_stats_file_count: 11
  -
    - smprofiler-IT-mnist-keras-cpu-disabled
    - *Enable
    - *mnist_cpu
    - AmazonSageMaker-ExecutionRole-20200205T150348
    - ml.c5.4xlarge
    - instance_count: 1
    - profiler_params:
        ProfilerEnabled: "False"
    - expected_values_in_test_artifacts:
        python_trace_file_count: 0
        framework_trace_file_count: 0
        python_stats_file_count: 0
  -
    - smprofiler-IT-mnist-keras-cpu-absent
    - *Enable
    - *mnist_cpu
    - AmazonSageMaker-ExecutionRole-20200205T150348
    - ml.c5.4xlarge
    - instance_count: 1
    - profiler_params:
    - expected_values_in_test_artifacts:
        python_trace_file_count: 0
        framework_trace_file_count: 0
        python_stats_file_count: 0
  -
    - smprofiler-IT-mnist-keras-cpu-custom
    - *Enable
    - *mnist_cpu
    - AmazonSageMaker-ExecutionRole-20200205T150348
    - ml.c5.4xlarge
    - instance_count: 1
    - profiler_params:
        ProfilerEnabled: "True"
        DetailedProfilingConfig: "{\"NumSteps\": \"3\"}"
        UsePyinstrument: "True"
        RotateMaxFileSizeInBytes: "12485760.34"
        RotateFileCloseIntervalInSeconds: "100.45"
        FileOpenFailThreshold: "35"
    - expected_values_in_test_artifacts:
        python_trace_file_count: 1
        framework_trace_file_count: 11
        python_stats_file_count: 14
  -
    - smprofiler-IT-keras-resnet-cpu-hvd-multinode
    - *Disable
    - *keras_resnet_hvd
    - AmazonSageMaker-ExecutionRole-20200205T150348
    - ml.c5.4xlarge
    - instance_count: 2
    - profiler_params:
        RotateMaxFileSizeInBytes: "15485760"
        RotateFileCloseIntervalInSeconds: "100"
        FileOpenFailThreshold: "35"
        ProfilerEnabled: "True"
    - expected_values_in_test_artifacts:
        python_trace_file_count: 2
        framework_trace_file_count: 4
        python_stats_file_count: 1

- gpu_jobs:
  -
    - smprofiler-IT-keras-resnet-gpu-hvd
    - *Enable
    - *keras_resnet_hvd
    - AmazonSageMaker-ExecutionRole-20200205T150348
    - ml.p2.8xlarge
    - instance_count: 1
    - profiler_params:
        ProfilerEnabled: "True"
    - expected_values_in_test_artifacts:
        python_trace_file_count: 1
        framework_trace_file_count: 3
        python_stats_file_count: 1
  -
    - smprofiler-IT-keras-resnet-gpu-mirrored
    - *Enable
    - *keras_resnet_mirrored
    - AmazonSageMaker-ExecutionRole-20200205T150348
    - ml.p2.8xlarge
    - instance_count: 1
    - profiler_params:
        ProfilerEnabled: "True"
        RotateMaxFileSizeInBytes: "20485760"
        RotateFileCloseIntervalInSeconds: "100"
        FileOpenFailThreshold: "35"
    - expected_values_in_test_artifacts:
        python_trace_file_count: 1
        framework_trace_file_count: 7
        python_stats_file_count: 1
  -
    - smprofiler-IT-mnist-keras-gpu-default
    - *Enable
    - *mnist_gpu
    - AmazonSageMaker-ExecutionRole-20200205T150348
    - ml.p2.8xlarge
    - instance_count: 1
    - profiler_params:
        ProfilerEnabled: "True"
        DetailedProfilingConfig: "{\"StartStep\": \"1\"}"
        UsePyinstrument: "True"
    - expected_values_in_test_artifacts:
        python_trace_file_count: 1
        framework_trace_file_count: 2
        python_stats_file_count: 6
  -
    - smprofiler-IT-mnist-keras-gpu-disabled
    - *Enable
    - *mnist_gpu
    - AmazonSageMaker-ExecutionRole-20200205T150348
    - ml.p2.8xlarge
    - instance_count: 1
    - profiler_params:
        ProfilerEnabled: "False"
    - expected_values_in_test_artifacts:
        python_trace_file_count: 0
        framework_trace_file_count: 0
        python_stats_file_count: 0
  -
    - smprofiler-IT-mnist-keras-gpu-absent
    - *Enable
    - *mnist_gpu
    - AmazonSageMaker-ExecutionRole-20200205T150348
    - ml.p2.8xlarge
    - instance_count: 1
    - profiler_params:
    - expected_values_in_test_artifacts:
        python_trace_file_count: 0
        framework_trace_file_count: 0
        python_stats_file_count: 0
  -
    - smprofiler-IT-mnist-keras-gpu-custom
    - *Enable
    - *mnist_gpu
    - AmazonSageMaker-ExecutionRole-20200205T150348
    - ml.p2.8xlarge
    - instance_count: 1
    - profiler_params:
        ProfilerEnabled: "True"
        DetailedProfilingConfig: "{\"DurationInSeconds\": \"100\"}"
        UsePyinstrument: "False"
        RotateMaxFileSizeInBytes: "5485760"
        RotateFileCloseIntervalInSeconds: "50"
        FileOpenFailThreshold: "35"
    - expected_values_in_test_artifacts:
        python_trace_file_count: 1
        framework_trace_file_count: 2
        python_stats_file_count: 21
  -
    - smprofiler-IT-keras-resnet-gpu-hvd-multinode
    - *Enable
    - *keras_resnet_hvd
    - AmazonSageMaker-ExecutionRole-20200205T150348
    - ml.p2.8xlarge
    - instance_count: 2
    - profiler_params:
        ProfilerEnabled: "True"
        RotateMaxFileSizeInBytes: "15485760"
        RotateFileCloseIntervalInSeconds: "100"
        FileOpenFailThreshold: "35"
    - expected_values_in_test_artifacts:
        python_trace_file_count: 2
        framework_trace_file_count: 4
        python_stats_file_count: 2
  -
    - smprofiler-IT-keras-resnet-gpu-mirrored
    - *Disable
    - *keras_resnet_mirrored
    - AmazonSageMaker-ExecutionRole-20200205T150348
    - ml.p2.8xlarge
    - instance_count: 2
    - profiler_params:
        ProfilerEnabled: "True"
        RotateMaxFileSizeInBytes: "20485760"
        RotateFileCloseIntervalInSeconds: "100"
        FileOpenFailThreshold: "35"
    - expected_values_in_test_artifacts:
        python_trace_file_count: 2
        framework_trace_file_count: 14
        python_stats_file_count: 1
