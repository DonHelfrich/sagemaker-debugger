- values:
  - [pt_res50_cifar10.py: &pt_res50_cifar10
      pt_res50_cifar10.py,
     horovod_test_launcher: &horovod_test_launcher
      horovod_test_launcher.py,
     smdataparallel_mnist: &smdataparallel_mnist
      smdataparallel_mnist.py,
     distributed_test_launcher: &distributed_test_launcher
      distributed_launch.py,
     Enable: &Enable # enable the test case
      True,
     Disable: &Disable # disable the test case
      False,
    ]
- cpu_jobs:
  -
    - smprofiler-IT-pt-resnet-cpu-default
    - *Enable
    - *pt_res50_cifar10
    - AmazonSageMaker-ExecutionRole-20200205T150348
    - ml.c5.4xlarge
    - instance_count: 1
    - profiler_params:
        ProfilerEnabled: "True"
        PythonProfilingConfig: "{\"StartStep\": \"4\", \"NumSteps\": \"5\", \"ProfilerName\": \"cprofile\"}"
    - expected_values_in_test_artifacts:
        python_trace_file_count: 11
        framework_trace_file_count: 0
        python_stats_file_count: 11
    - hyper_params:
        batch_size: 256
  -
    - smprofiler-IT-pt-resnet-cpu-pyinstru
    - *Enable
    - *pt_res50_cifar10
    - AmazonSageMaker-ExecutionRole-20200205T150348
    - ml.c5.4xlarge
    - instance_count: 1
    - profiler_params:
        ProfilerEnabled: "True"
        PythonProfilingConfig: "{\"NumSteps\": \"3\", \"ProfilerName\": \"pyinstrument\"}"
    - expected_values_in_test_artifacts:
        python_trace_file_count: 7
        framework_trace_file_count: 0
        python_stats_file_count: 14
    - hyper_params:
        batch_size: 256

  -
    - smprofiler-IT-pt-resnet-cpu-custom
    - *Enable
    - *pt_res50_cifar10
    - AmazonSageMaker-ExecutionRole-20200205T150348
    - ml.c5.4xlarge
    - instance_count: 1
    - profiler_params:
        ProfilerEnabled: "True"
        PythonProfilingConfig: "{\"NumSteps\": \"3\", \"ProfilerName\": \"pyinstrument\"}"
        RotateMaxFileSizeInBytes: "12485760.34"
        FileOpenFailThreshold: "35"
    - expected_values_in_test_artifacts:
        python_trace_file_count: 7
        framework_trace_file_count: 0
        python_stats_file_count: 14
    - hyper_params:
        batch_size: 256

  -
    - smprofiler-IT-pt-resnet-cpu-disable
    - *Enable
    - *pt_res50_cifar10
    - AmazonSageMaker-ExecutionRole-20200205T150348
    - ml.c5.4xlarge
    - instance_count: 1
    - profiler_params:
        ProfilerEnabled: "False"
    - expected_values_in_test_artifacts:
        python_trace_file_count: 0
        framework_trace_file_count: 0
        python_stats_file_count: 0
    - hyper_params:
        batch_size: 1024

  -
    - smprofiler-IT-pt-resnet-cpu-absent
    - *Enable
    - *pt_res50_cifar10
    - AmazonSageMaker-ExecutionRole-20200205T150348
    - ml.c5.4xlarge
    - instance_count: 1
    - profiler_params:
    - expected_values_in_test_artifacts:
        python_trace_file_count: 0
        framework_trace_file_count: 0
        python_stats_file_count: 0
    - hyper_params:
        batch_size: 1024

- gpu_jobs:
  -
    - smprofiler-IT-pt-resnet-gpu-default
    - *Enable
    - *pt_res50_cifar10
    - AmazonSageMaker-ExecutionRole-20200205T150348
    - ml.p2.8xlarge
    - instance_count: 1
    - profiler_params:
        ProfilerEnabled: "True"
        PythonProfilingConfig: "{\"NumSteps\": \"3\", \"ProfilerName\": \"pyinstrument\"}"
    - expected_values_in_test_artifacts:
        python_trace_file_count: 3
        framework_trace_file_count: 0
        python_stats_file_count: 14
    - hyper_params:
        gpu: 4
        batch_size: 1024
  -
    - smprofiler-IT-pt-resnet-gpu-disable
    - *Enable
    - *pt_res50_cifar10
    - AmazonSageMaker-ExecutionRole-20200205T150348
    - ml.p2.8xlarge
    - instance_count: 1
    - profiler_params:
        ProfilerEnabled: "False"
    - expected_values_in_test_artifacts:
        python_trace_file_count: 0
        framework_trace_file_count: 0
        python_stats_file_count: 0
    - hyper_params:
        gpu: 4
        batch_size: 1024

  -
    - smprofiler-IT-pt-resnet-gpu-enable
    - *Enable
    - *pt_res50_cifar10
    - AmazonSageMaker-ExecutionRole-20200205T150348
    - ml.p2.8xlarge
    - instance_count: 1
    - profiler_params:
        ProfilerEnabled: "True"
        PythonProfilingConfig: "{\"StartStep\": \"4\", \"NumSteps\": \"5\", \"ProfilerName\": \"cprofile\"}"
    - expected_values_in_test_artifacts:
        python_trace_file_count: 11
        framework_trace_file_count: 0
        python_stats_file_count: 11
    - hyper_params:
        gpu: 4
        batch_size: 1024

  -
    - smprofiler-IT-pt-resnet-gpu-absent
    - *Enable
    - *pt_res50_cifar10
    - AmazonSageMaker-ExecutionRole-20200205T150348
    - ml.p2.8xlarge
    - instance_count: 1
    - profiler_params:
    - expected_values_in_test_artifacts:
        python_trace_file_count: 0
        framework_trace_file_count: 0
        python_stats_file_count: 0
    - hyper_params:
        gpu: 4
        batch_size: 1024

  -
    - smprofiler-IT-pt-resnet-gpu-custom
    - *Enable
    - *pt_res50_cifar10
    - AmazonSageMaker-ExecutionRole-20200205T150348
    - ml.p2.8xlarge
    - instance_count: 1
    - profiler_params:
        ProfilerEnabled: "True"
        PythonProfilingConfig: "{\"NumSteps\": \"3\", \"ProfilerName\": \"pyinstrument\"}"
        RotateMaxFileSizeInBytes: "12485760.34"
        RotateFileCloseIntervalInSeconds: "100.45"
        FileOpenFailThreshold: "35"
    - expected_values_in_test_artifacts:
        python_trace_file_count: 3
        framework_trace_file_count: 0
        python_stats_file_count: 14
    - hyper_params:
        gpu: 4
        batch_size: 1024

  -
    - smprofiler-IT-pt-horovod-gpu-disable
    - *Enable
    - *horovod_test_launcher
    - AmazonSageMaker-ExecutionRole-20200205T150348
    - ml.p2.8xlarge
    - instance_count: 1
    - profiler_params:
        ProfilerEnabled: "False"
    - expected_values_in_test_artifacts:
        python_trace_file_count: 0
        framework_trace_file_count: 0
        python_stats_file_count: 0
        horovod_trace_file_count: 0
    - hyper_params:
        gpu: 4

  -
    - smprofiler-IT-pt-horovod-gpu-enable
    - *Enable
    - *horovod_test_launcher
    - AmazonSageMaker-ExecutionRole-20200205T150348
    - ml.p2.8xlarge
    - instance_count: 1
    - profiler_params:
        ProfilerEnabled: "True"
        PythonProfilingConfig: "{\"NumSteps\": \"1\", \"ProfilerName\": \"cprofile\"}"
    - expected_values_in_test_artifacts:
        python_trace_file_count: 4
        framework_trace_file_count: 0
        python_stats_file_count: 24
        horovod_trace_file_count: 1
    - hyper_params:
        gpu: 4

  -
    - smprofiler-IT-pt-horovod-gpu-absent
    - *Enable
    - *horovod_test_launcher
    - AmazonSageMaker-ExecutionRole-20200205T150348
    - ml.p2.8xlarge
    - instance_count: 1
    - profiler_params:
    - expected_values_in_test_artifacts:
        python_trace_file_count: 0
        framework_trace_file_count: 0
        python_stats_file_count: 0
        horovod_trace_file_count: 0
    - hyper_params:
        gpu: 4


  -
    - smprofiler-IT-pt-horovod-gpu-cifar-enable
    - *Enable
    - *horovod_test_launcher
    - AmazonSageMaker-ExecutionRole-20200205T150348
    - ml.p2.8xlarge
    - instance_count: 1
    - profiler_params:
        ProfilerEnabled: "True"
        PythonProfilingConfig: "{\"NumSteps\": \"1\", \"ProfilerName\": \"cprofile\"}"
    - expected_values_in_test_artifacts:
        python_trace_file_count: 4
        framework_trace_file_count: 0
        python_stats_file_count: 24
        horovod_trace_file_count: 1
    - hyper_params:
        gpu: 4
        script: pt_res50_cifar10_horovod.py
        batch_size: 256

  -
    - smprofiler-IT-pt-smdataparallel-gpu-enable
    - *Disable
    - *smdataparallel_mnist
    - AmazonSageMaker-ExecutionRole-20200205T150348
    - ml.p3.16xlarge
    - instance_count: 1
    - profiler_params:
        ProfilerEnabled: "True"
        PythonProfilingConfig: "{\"NumSteps\": \"1\", \"ProfilerName\": \"cprofile\"}"
        SMDataparallelProfilingConfig: "{\"StartStep\": \"2\", \"NumSteps\": \"1\"}"
    - expected_values_in_test_artifacts:
        python_trace_file_count: 4
        framework_trace_file_count: 0
        python_stats_file_count: 24
        smdataparallel_trace_file_count: 8
    - hyper_params:
        sagemaker_distributed_dataparallel_enabled: "True"
        epochs: 1

  -
    - smprofiler-IT-pt-resnet-gpu-distributed
    - *Enable
    - *distributed_test_launcher
    - AmazonSageMaker-ExecutionRole-20200205T150348
    - ml.p2.8xlarge
    - instance_count: 1
    - profiler_params:
        ProfilerEnabled: "True"
        RotateMaxFileSizeInBytes: "12485760.34"
        RotateFileCloseIntervalInSeconds: "100.45"
        FileOpenFailThreshold: "35"
    - expected_values_in_test_artifacts:
        python_trace_file_count: 8
        framework_trace_file_count: 0
        python_stats_file_count: 28
    - hyper_params:
        training_script: pt_res50_cifar10_distributed.py
        nproc_per_node: 4
